<div class="pt-10 sm:pt-32 flex h-screen overflow-x-scroll">
    <!-- COLONNE SPRINTS -->

    <div
        id="sprintsCol"
        class="bg-grey1 text-white h-full w-1/6 xl:w-1/12 px-5 py-3 overflow-x-hidden"
    >
        <div class="flex flex-col justify-start items-center text-center">
            <button
                title="Show global view"
                (click)="closeSprintBar()"
                class="hover:bg-secondary hover:text-white p-3 rounded-xl m-2 text-xs font-semibold justify-center"
                [ngClass]="{
                    'bg-primary text-white': !parentProject,
                    'text-primary': parentProject
                }"
                [disabled]="!parentProject"
            >
                {{ 'infrascrum.project.btn-global' | translate }}
            </button>

            <button
                *ngIf="!parentProject"
                (click)="addSprint()"
                class="bg-primary hover:bg-secondary border-2 text-white text-center p-2 rounded-xl h-12 text-xs"
                title="Add a sprint"
            >
                {{ 'infrascrum.project.btn-add' | translate }}
            </button>
            <!-- Boucler sur le nombre de sprints  -->
            <div
                class="flex justify-center items-center mt-8"
                *ngFor="let sprint of sprintList"
            >
                <button
                    (click)="changeSprintDisplay(sprint.id)"
                    class="hover:bg-secondary hover:text-white p-3 rounded-xl m-2 text-xs font-semibold justify-center"
                    [ngClass]="{
                        'bg-primary text-white': sprint.id == projectid,
                        'text-primary': sprint.id != projectid
                    }"
                    [disabled]="sprint.id == projectid"
                >
                    {{ sprint.name }}
                </button>
                <!-- Si sprint terminé, icône V coché  -->
                <div
                    *ngIf="sprint.enddate && sprint.enddate < dateToday"
                    class=""
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="w-5 h-5 text-tpkvalidate"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- KANBAN DASHBOARD -->

    <div id="kanbanDashboard" class="w-11/12 overflow-y-scroll">
        <!-- Header  -->
        <div
            id="kanbanHeader"
            class="flex justify-between h-1/12 py-2 bg-grey1 w-full fixed z-0"
        >
            <!-- boutons edit project, add task et add column -->

            <div class="flex items-center justify-start pl-6">
                <button
                    *ngIf="
                        project &&
                        (user.role.name == 'admin' ||
                            user.role.name == 'superadmin' ||
                            isUserProjectadmin)
                    "
                    (click)="editProject()"
                    title="Edit project"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="w-8 h-8 text-white bg-primary border-2 border-primary hover:border-secondary hover:text-white hover:bg-secondary font-bold mr-8 rounded"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 13.5V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 9.75V10.5"
                        />
                    </svg>
                </button>
                <button
                    (click)="addTask()"
                    class="bg-primary hover:bg-secondary text-white p-2 rounded-xl h-8 text-xs mr-6"
                    title="Add a new task"
                >
                    {{ 'infrascrum.project.btn-new-task' | translate }}
                </button>
                <button
                    (click)="addnewKanbanStatus()"
                    class="bg-primary hover:bg-secondary text-white p-2 rounded-xl h-8 text-xs mr-8"
                    title="Add a new task"
                >
                    {{ 'infrascrum.project.btn-new-column' | translate }}
                </button>
                <div
                    class="flex items-center"
                    *ngFor="let userProject of userProjects"
                >
                    <div
                        class="userChipSmall w-7 h-7 md:w-8 md:h-8 rounded-full bg-secondary text-white flex items-center justify-center hover:cursor-pointer"
                    >
                        <!-- condition si photo, sinon span avec premiere lettre username -->
                        <img
                            *ngIf="userProject.user.picture"
                            class="rounded-full hover:cursor-default"
                            [src]="userProject.user.picture"
                            alt="profile picture"
                            title="{{ userProject.user.username }}"
                        />
                        <span
                            *ngIf="!userProject.user.picture"
                            class="text-2xl uppercase font-bold"
                            title="{{ userProject.user.username }}"
                        >
                            {{ userProject.user.username | initialsName }}
                        </span>
                    </div>
                </div>
            </div>
            <!-- Dates intermédiaires à ajouter ?? -->
            <!--  -->
            <!-- Delivery date -->
            <div
                class="flex justify-end items-center text-primary mr-52 xl:mr-40 ml-4"
            >
                <h4 class="pr-2">Delivery date :</h4>
                <p>
                    {{
                        project.enddate
                            ? (project.enddate | date: 'dd-MMM-yyyy')
                            : '/'
                    }}
                </p>
            </div>

            <!-- PLUS BESOIN, affichage global est passé dans navbar latérale, avec l'affichage des sprints -->

            <!-- header 2/3 -->

            <!-- 
            <div class="flex items-end w-1/3"> -->

            <!-- <button
                    (click)="closeSprintBar()"
                    [ngClass]="{
                        'text-primary': isSprintsOpen,
                        'bg-secondary text-white': !isSprintsOpen
                    }"
                    class="hover:bg-secondary hover:text-white p-3 rounded-xl m-2 text-xl font-bold"
                >
                    Global
                </button>
                <button
                    (click)="openSprintBar()"
                    [ngClass]="{
                        'text-primary': !isSprintsOpen,
                        'bg-secondary text-white': isSprintsOpen
                    }"
                    class="hover:bg-secondary hover:text-white p-3 rounded-xl m-2 text-xl font-bold"
                >
                    Sprints
                </button> -->
            <!-- </div> -->

            <!-- header 3/3 -->

            <!-- Users assignés au project  -->

            <!-- <div class="flex pr-4">
                USERS
            </div> -->
        </div>

        <!-- Kanban columns  -->

        <!-- <div cdkDropListGroup id="kanban" class="flex px-12 pb-12 pt-16"> -->
        <!-- boucler sur les kanbanstatus du projet  -->
        <!--     <div class="flex">
                <div
                    *ngFor="let kanbanstatus of kanbanList; let i = index"
                    cdkDropList
                    [cdkDropListData]="i"
                    class="flex flex-col"
                >
                    <div
                        cdkDrag
                        [cdkDragData]="i"
                        (cdkDragEntered)="dragEntered($event)"
                        (cdkDragMoved)="dragMoved($event)"
                        (cdkDragDropped)="dragDropped($event)"
                    >
                        <app-kanban-status
                            [subject]="subject"
                            [kanbanList]="kanbanstatus"
                            (kanbanDeleted)="
                                onKanbanDeleted(kanbanstatus.kanban)
                            "
                            [taskTypeList]="taskTypeList"
                            [userProjectList]="userProjects"
                            [sprintList]="sprintList"
                            [projectid]="projectid"
                            [project]="project"
                        ></app-kanban-status>
                    </div>
                </div> -->

        <!-- BOUTON NEW COLUMN  -->

        <!-- <div class="w-36 mx-4 mt-6">
                    <button
                        (click)="addnewKanbanStatus()"
                        class="bg-grey1 rounded-md hover:shadow-sm hover:shadow-secondary"
                    >
                        <div
                            class="w-full bg-primary text-white h-6 rounded-t-lg p-2 flex items-center justify-center"
                        >
                            <h3 class="text-center font-bold text-xs">
                                {{
                                    'infrascrum.project.btn-add-column'
                                        | translate
                                }}
                            </h3>
                        </div>
                        <div class="h-12 items-center flex justify-center">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                class="w-5 h-5 font-extrabold"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M12 4.5v15m7.5-7.5h-15"
                                />
                            </svg>
                        </div>
                    </button>
                </div>
            </div>
        </div> -->
        <!-- fin kanban columns-->

        <!-- début test -->
        <div
            cdkDropList
            cdkDropListOrientation="horizontal"
            (cdkDropListDropped)="dropColumns($event)"
        >
            <div cdkDropListGroup class="flex px-12 pb-12 pt-16">
                <div
                    class="example-container"
                    *ngFor="let kanban of kanbanList; let i = index"
                    cdkDrag
                >
                    <app-kanban-status
                        [subject]="subject"
                        [kanbanList]="kanban"
                        (kanbanDeleted)="onKanbanDeleted(kanban.kanban)"
                        [taskTypeList]="taskTypeList"
                        [sprintList]="sprintList"
                        [projectid]="projectid"
                        [project]="project"
                    ></app-kanban-status>

                    <div
                        cdkDropList
                        [cdkDropListData]="kanban.tasks"
                        class="example-list kanbanStatusTitle flex flex-col w-64 mx-4 mt-6"
                        (cdkDropListDropped)="drop($event)"
                    >
                        <div *ngFor="let task of kanban.tasks" cdkDrag>
                            <app-task
                                [task]="task"
                                [subject]="subject"
                                [taskTypeList]="taskTypeList"
                                [sprintList]="sprintList"
                                [projectid]="projectid"
                                [project]="project"
                            ></app-task>
                        </div>
                    </div>
                </div>
                <div class="w-36 mx-4 mt-6">
                    <button
                        (click)="addnewKanbanStatus()"
                        class="bg-grey1 rounded-md hover:shadow-sm hover:shadow-secondary"
                    >
                        <div
                            class="w-full bg-primary text-white h-6 rounded-t-lg p-2 flex items-center justify-center"
                        >
                            <h3 class="text-center font-bold text-xs">
                                {{
                                    'infrascrum.project.btn-add-column'
                                        | translate
                                }}
                            </h3>
                        </div>
                        <div class="h-12 items-center flex justify-center">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                                stroke="currentColor"
                                class="w-5 h-5 font-extrabold"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M12 4.5v15m7.5-7.5h-15"
                                />
                            </svg>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <!-- fin test -->
    </div>
    <!-- fin kanban dashboard -->
</div>
